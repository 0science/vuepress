# **密码学相关知识**

**背景知识**

Windows所创建的每个进程都从调用CreateProcess() API函数开始，该函数的任务是在对象管理器子系统内初始化进程对象。每一进程都以调用ExitProcess() 或TerminateProcess() API函数终止。通常应用程序的框架负责调用 ExitProcess() 函数。对于C++ 运行库来说，这一调用发生在应用程序的main() 函数返回之后。

    **1. 创建进程**

CreateProcess() 调用的核心参数是可执行文件运行时的文件名及其命令行。表 3-4详细地列出了每个参数的类型和名称。

表3-4 CreateProcess() 函数的参数

|   |   |
|---|---|
|参数名称|使用目的|
|LPCTSTR lpApplivationName|全部或部分地指明包括可执行代码的EXE文件的文件名|
|LPCTSTR lpCommandLine|向可执行文件发送的参数|
|LPSECURIITY_ATTRIBUTES lpProcessAttributes|返回进程句柄的安全属性。主要指明这一句柄是否应该由其他子进程所继承|
|LPSECURIITY_ATTRIBUTES lpThreadAttributes|返回进程的主线程的句柄的安全属性|
|BOOL bInheritHandle|一种标志，告诉系统允许新进程继承创建者进程的句柄|
|DWORD dwCreationFlage|特殊的创建标志 (如CREATE_SUSPENDED) 的位标记|
|LPVOID lpEnvironment|向新进程发送的一套环境变量；如为null值则发送调用者环境|
|LPCTSTR lpCurrentDirectory|新进程的启动目录|
|STARTUPINFO lpStartupInfo|STARTUPINFO结构，包括新进程的输入和输出配置的详情|
|LPPROCESS_INFORMATION lpProcessInformation|调用的结果块；发送新应用程序的进程和主线程的句柄和ID|

可以指定第一个参数，即应用程序的名称，其中包括相对于当前进程的当前目录的全路径或者利用搜索方法找到的路径；lpCommandLine参数允许调用者向新应用程序发送数据；接下来的三个参数与进程和它的主线程以及返回的指向该对象的句柄的安全性有关。

然后是标志参数，用以在dwCreationFlags参数中指明系统应该给予新进程什么行为。经常使用的标志是CREATE_SUSPNDED，告诉主线程立刻暂停。当准备好时，应该使用ResumeThread() API来启动进程。另一个常用的标志是CREATE_NEW_CONSOLE，告诉新进程启动自己的控制台窗口，而不是利用父窗口。这一参数还允许设置进程的优先级，用以向系统指明，相对于系统中所有其他的活动进程来说，给此进程多少CPU时间。

接着是CreateProcess() 函数调用所需要的三个通常使用缺省值的参数。第一个参数是lpEnvironment参数，指明为新进程提供的环境；第二个参数是lpCurrentDirectory，可用于向主创进程发送与缺省目录不同的新进程使用的特殊的当前目录；第三个参数是STARTUPINFO数据结构所必需的，用于在必要时指明新应用程序的主窗口的外观。

CreateProcess() 的最后一个参数是用于新进程对象及其主线程的句柄和ID的返回值缓冲区。以PROCESS_INFORMATION结构中返回的句柄调用CloseHandle() API函数是重要的，因为如果不将这些句柄关闭的话，有可能危及主创进程终止之前的任何未释放的资源。

    **2. 正在运行的进程**

如果一个进程拥有至少一个执行线程，则为正在系统中运行的进程。通常，这种进程使用主线程来指示它的存在。当主线程结束时，调用ExitProcess() API函数，通知系统终止它所拥有的所有正在运行、准备运行或正在挂起的其他线程。当进程正在运行时，可以查看它的许多特性，其中少数特性也允许加以修改。

首先可查看的进程特性是系统进程标识符 (PID) ，可利用GetCurrentProcessId() API函数来查看，与GetCurrentProcess() 相似，对该函数的调用不能失败，但返回的PID在整个系统中都可使用。其他的可显示当前进程信息的API函数还有GetStartupInfo()和GetProcessShutdownParameters() ，可给出进程存活期内的配置详情。

通常，一个进程需要它的运行期环境的信息。例如API函数GetModuleFileName() 和GetCommandLine() ，可以给出用在CreateProcess() 中的参数以启动应用程序。在创建应用程序时可使用的另一个API函数是IsDebuggerPresent() 。

可利用API函数GetGuiResources() 来查看进程的GUI资源。此函数既可返回指定进程中的打开的GUI对象的数目，也可返回指定进程中打开的USER对象的数目。进程的其他性能信息可通过GetProcessIoCounters()、GetProcessPriorityBoost() 、GetProcessTimes() 和GetProcessWorkingSetSize() API得到。以上这几个API函数都只需要具有PROCESS_QUERY_INFORMATION访问权限的指向所感兴趣进程的句柄。

另一个可用于进程信息查询的API函数是GetProcessVersion() 。此函数只需感兴趣进程的PID (进程标识号) 。本实验程序清单3-6中列出了这一API函数与GetVersionEx() 的共同作用，可确定运行进程的系统的版本号。

    **3. 终止进程**

所有进程都是以调用ExitProcess() 或者TerminateProcess() 函数结束的。但最好使用前者而不要使用后者，因为进程是在完成了它的所有的关闭“职责”之后以正常的终止方式来调用前者的。而外部进程通常调用后者即突然终止进程的进行，由于关闭时的途径不太正常，有可能引起错误的行为。

TerminateProcess() API函数只要打开带有PROCESS_TERMINATE访问权的进程对象，就可以终止进程，并向系统返回指定的代码。这是一种“野蛮”的终止进程的方式，但是有时却是需要的。

如果开发人员确实有机会来设计“谋杀”(终止别的进程的进程) 和“受害”进程 (被终止的进程) 时，应该创建一个进程间通讯的内核对象——如一个互斥程序——这样一来，“受害”进程只在等待或周期性地测试它是否应该终止。

    **4.进程同步**

Windows 2000/XP提供的常用对象可分成三类：核心应用服务、线程同步和线程间通讯。其中，开发人员可以使用线程同步对象来协调线程和进程的工作，以使其共享信息并执行任务。此类对象包括互锁数据、临界段、事件、互斥体和信号等。

多线程编程中关键的一步是保护所有的共享资源，工具主要有互锁函数、临界段和互斥体等；另一个实质性部分是协调线程使其完成应用程序的任务，为此，可利用内核中的事件对象和信号。

在进程内或进程间实现线程同步的最方便的方法是使用事件对象，这一组内核对象允许一个线程对其受信状态进行直接控制 (见表2-1) 。

而互斥体则是另一个可命名且安全的内核对象，其主要目的是引导对共享资源的访问。拥有单一访问资源的线程创建互斥体，所有想要访问该资源的线程应该在实际执行操作之前获得互斥体，而在访问结束时立即释放互斥体，以允许下一个等待线程获得互斥体，然后接着进行下去。

与事件对象类似，互斥体容易创建、打开、使用并清除。利用CreateMutex() API可创建互斥体，创建时还可以指定一个初始的拥有权标志，通过使用这个标志，只有当线程完成了资源的所有的初始化工作时，才允许创建线程释放互斥体。

表2-1 用于管理事件对象的API

|   |   |
|---|---|
|API名称|描述|
|CreateEvent()|在内核中创建一个新的事件对象。此函数允许有安全性设置、手工还是自动重置的标志以及初始时已接受还是未接受信号状态的标志|
|OpenEvent()|创建对已经存在的事件对象的引用。此API函数需要名称、继承标志和所需的访问级别|
|SetEvent()|将手工重置事件转化为已接受信号状态|
|ResetEvent()|将手工重置事件转化为非接受信号状态|
|PulseEvent()|将自动重置事件对象转化为已接受信号状态。当系统释放所有的等待它的线程时此种转化立即发生|

为了获得互斥体，首先，想要访问调用的线程可使用OpenMutex() API来获得指向对象的句柄；然后，线程将这个句柄提供给一个等待函数。当内核将互斥体对象发送给等待线程时，就表明该线程获得了互斥体的拥有权。当线程获得拥有权时，线程控制了对共享资源的访问——必须设法尽快地放弃互斥体。放弃共享资源时需要在该对象上调用ReleaseMute() API。然后系统负责将互斥体拥有权传递给下一个等待着的线程 (由到达时间决定顺序) 。

【问答题】密码技术的作用
答案：
（一）保密性：在通信中消息发送方与接收方都希望保密，只有消息的发送者和接收者才能理解消息的内容。
（二）可鉴别性：安全通信仅仅靠消息的机密性是不够的，必须加以验证，接收者需要确定消息发送者的身份。
（三）完整性：安全通信中还必须保持消息的完整, 即消息在传送过程中不发生改变。
（四）不可否认性：安全通信的一个基本要素就是不可否认性，防止发送者抵赖否定。
【问答题】什么是密码体制?
答案：
（一）明文空间M：全体明文的集合
（二）密文空间
C．全体密文的集合
（三）密钥空间K：全体密钥的集合，K=<Ke,Kd>
（四）加密算法
E．一族由M到C的加密变换
（五）解密算法
D．一族由C到M的解密变换，
（六）加密：C=E(M, Ke )，解密：M=D(C, Kd)
（七）可逆操作，解密变换是加密变换的逆
【问答题】密码体制分类为哪两类?
答案：
（一）对称加密：单密钥（Ke=Kd），加密/解密速度快，密钥难于管理
（二）非对称加密：双密钥（Ke≠Kd），加密/解密速度慢，密钥易于管理，签名
【知识点】密码攻击法分为（蛮力攻击法）和（分析攻击法）。
【知识点】替代密码分为（单表替代密码），（位移替代密码/k=3为凯撒密码）和（仿射密码）。
【问答题】单表替代密码
答案：
（一）一般单表替代密码的原理是以26个英文字母集合上的一个置换π为密钥，对明文消息中的每个字母依次进行变换。
（二）可描述为：明文空间M和密文空间C都是26个英文字母的集合，密钥空间K={π：Z26→Z26|π是置换}，是所有可能置换的集合
（三）对任意π∈K，定义:加密变换：eπ(m)=π(m)=c；解密变换：dπ
C．= π-1
C．=m，π-1是π的逆置换
【问答题】位移替代密码
答案：
（一）c=Ek(m)=（m+k）mod q
（二）m=Dk
C．=（c-k）mod q
【问答题】用凯撒密码加密sanyauniversity
答案：vbqbdxqlyhuvlwb
【问答题】仿射密码
答案：
（一）仿射密码也是一般单表替代密码的一个特例，是一种线性变换。
（二）仿射密码的明文空间和密文空间与移位密码相同，但密钥空间为 K={(k1，k2)| k1，k2∈Z26，gcd(k1，26)=1}
（三）c = Ek (m) = k1 m +k2 (mod 26)
（四）m = Dk
C．= k1-1 (c-k2) (mod 26)
（五）k1=1时即为移位密码，而k2=0则称为乘法密码
【问答题】用仿射密码加密sanyau,其中k1=3,k2=2
答案：ecpwck
【问答题】多表替代密码
答案：
（一）为了对抗频率分析
（二）使用多个替代表依次对明文的字母进行替代
（三）同一字母可由不同的字母替代
（四）m=mm2K
（五）π=（π1，π2，K)
（六）c=E(m)=π1(m1)π2(m2)K
【问答题】用Vigenere密码加密sanyauniversity，密钥=mykey
答案：eyxcyglszcdqsxw
【问答题】置换密码
答案：
（一）换位操作
（二）明文和密文的元素相同，仅位置不同
【问答题】给定明文为cryptography，密钥π=3,5,1,6,4,2,密文是
答案：ytcoprahgypr
【问答题】加密helloworld,密钥为(3 4 1 5 2)
答案：llhoerlwdo
【知识点】数据加密技术分为（流密码）和（分组密码）。
【问答题】分组密码
答案：
（一）加密单位为定长的二进制块
（二）明文经过编码变为二进制码流，加密将明文分为长度更小的具有固定长度的分组
（三）使用同一密钥对每个分组进行加密
（四）密文分组中的每一位均与明文分组的所有位相关
（五）P盒------置换或变位
（六）S盒------替换
【知识点】分组密码的常用加密模式有（电子密码本模式），（密文分组链接模式）和（密文反馈模式）
【问答题】电子密码本模式（ECB）
答案：
（一）每个分组使用相同的密钥加密
（二）分组间没有联系
（三）呈现一定的规律，影响安全性
【问答题】密文分组链接模式（CBC）
答案：
（一）加密算法的输入是下一个分组与上一个分组的异或
（二）安全性高
【问答题】密文反馈模式
答案：上一个密文分组作为密码算法的随机输入，与当前明文分组异或产生新的密文
【问答题】数据加密标准DES
答案：
（一）单密钥分组加密算法
（二）分组大小64bit，密钥长度56bit
（三）加密和解密步骤相同，宜于标准化和通用化
（四）随机性好，线性复杂度高，宜于实现
【问答题】DES加密算法
答案：
（一）使用用56位密钥加密64位明文，最后输出64位密文
（二）DES采用16轮相同的加密运算
（三）整个过程分为两大部分：加密过程和子密钥产生过程
【问答题】三重 DES
答案：
（一）使用三个56位密钥 k1, k2, k3
（二）采用加密—解密—加密(E-D-E)方案
（三）加密 C = Ek3(Dk2(Ek1(P)))
（四）解密 P = DK1(EK2(DK3
C．))
【问答题】高级数据加密标准（AES）
答案：
（一）分组密码:明文长度128,密文长度、密钥长度可变（128/192/256等,现在一般取 128 ） 
（二）面向二进制的密码算法:能够加解密任何形式的计算机数据。
（三）不是对合运算:加、解密使用不同的算法。
（四）综合运用置换、代替、代数等多种密码技术
（五）整体结构：基本轮函数加迭代。圈数可变，≥10
【问答题】对称密码体制的主要问题
答案：
（一）系统开放性差，需要可靠的密钥传递渠道。
（二）密钥管理量的困难，n个用户需要 C(n,2)=n(n-1)/2个密钥
（三）数字签名的问题，对称加密算法难以实现抗抵赖的安全需求
【问答题】公钥密码体制的原理
答案：
（一）双密钥K=< Ke,Kd>
（二）Ke ≠ Kd且由Ke 不能计算出 Kd
（三）Ke可公开, Kd保密K=(PK, SK)
（四）PK为公钥，SK为私钥
（五）SK严格保密，可作为个人的身份指纹
（六）加密算法E和解密算法D可逆
（七）方案1：c=E(m,PK), m=D(c, SK)
（八）方案2：c=E(m,SK), m=D(c, PK)
【问答题】RSA公钥体制
答案：
（一）选择两个素数p，q
（二）n=pq
（三）f(n)=(p-1)(q-1)
（四）寻找一个与f(n)互素的数d→gcd(f(n),d)=1
（五）计算d逆元e→de=1mod f(n)
（六）K=(n,p,g,e,d)
（七）n,e,公开；p,g,d保密
（八）加密过程：m e mod n=c,加密密钥e
（九）解密过程：c d mod n=m,解密密钥d
【问答题】密钥交换（密钥协商）
答案：
（一）通信双方通过不安全信道协商密钥
（二）窃听者无法获得密钥
【问答题】椭圆曲线密码体制(ECC)
答案：
（一）多数公钥密码 (RSA, ElGamal) 使用非常大的数或多项式
（二）给密钥和信息的存储和处理带来很大的运算量
（三）椭圆曲线是一个代替，可以用更小的尺寸得到同样的安全性
【问答题】
答案：
（一）
（二）
（三）
（四）
（五）
（六）
【名词解释】
解释：
【知识点】